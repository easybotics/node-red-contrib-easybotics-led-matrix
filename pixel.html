
<script type="text/javascript">
	RED.nodes.registerType('led-matrix', {
		category: 'config',
		defaults: {
			height: {value:64, required:true},
			width:  {value:64, required:true},
			chained: {value:2, required:true},
			parallel: {value:1, required:true},
			brightness: {value:100, required:true},
			mapping: {value:"adafruit-hat-pwm", required:true},
		},
		label: function() {
			return "LED MATRIX";
		}
	});
</script>

<script type="text/x-red" data-template-name="led-matrix">
	<div class="form-row">
		<label for="node-config-input-width"><i class="icon-bookmark"></i> Width</label>
		<input type="text" id="node-config-input-width">
	</div>
	<div class="form-row">
		<label for="node-config-input-height"><i class="icon-bookmark"></i> Height</label>
		<input type="text" id="node-config-input-height">
	</div>
	<div class="form-row">
		<label for="node-config-input-chained"><i class="icon-bookmark"></i> Chained Panels</label>
		<input type="text" id="node-config-input-chained">
	</div>

	<div class="form-row">
		<label for="node-config-input-parallel"><i class="icon-bookmark"></i> Parallel Panels</label>
		<input type="text" id="node-config-input-parallel">
	</div>

	<div class="form-row">

		<label for="node-config-input-brightness"><i class="icon-bookmark"></i> Panel Brightness</label>
		<input type="text" id="node-config-input-brightness">
	</div>

	<div class="form-row">
		<label for="node-config-input-mapping"><i class="icon-bookmark"></i> Hardware Mapping</label>
		<input type="text" id="node-config-input-mapping">
	</div>



</script>


<!--
	this block describes  the appearance of the node itself
	and also what type of settings it holds
	also the category, config is a special category; all others are arbitrary
-->

<script type="text/javascript">
    RED.nodes.registerType('pixel',{
        category: 'LED Matrix',
        color: '#a6bbcf',
        defaults: {
            name: {value:""},
            color: {value:"haa"},
            matrix: { type:'led-matrix', required:true},
        },
        inputs:1,
        outputs:0,
        icon: "file.png",
        label: function() {
            return this.name||"pixel to matrix";
        }
    });
</script>

<!--
	this block describes the settings page where we can select which config nodes to bind
	and other paramters we have previously mentioned in the 'defaults' block up there ^
-->

<script type="text/x-red" data-template-name="pixel">
    <div class="form-row">
        <label for="node-config-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
	<div class='form-row'>
		<label for="node-config-input-matrix"><i class='fa fa-tag'></i> Display</label>
		<input type='text' id='node-input-matrix'/>
	</div>
</script>

<!--
	this block describes the help text
-->

<script type="text/x-red" data-help-name="pixel">
    <p>prints a pixel on the matrix buffer, refresh the matrix to see the result </p>
</script>

<script type="text/javascript">
	RED.nodes.registerType("refresh-matrix",
	{
		category: 'LED Matrix',
		color: '#a6bbcf',
		defaults:
		{
			name: {value:""},
			matrix: {type: 'led-matrix', required:true},
		},
		inputs:1,
		outputs:0,
		icon: "file.png",
		label: function ()
		{
			return this.name || "refresh-matrix";
		}
	});
</script>

<script type="text/x-red" data-template-name="refresh-matrix">
	<div class="form-row">
		<label for="node-config-input-name"> <i class="icon-tag"></i> Name </label>
		<input type="text" id="node-input-name" placeholder="Name">
	</div>

	<div class="form-row">
		<label for="node-config-input-matrix"><i class='fa fa-tag'></i> Display </label>
		<input type="text" id="node-input-matrix"/>
	</div>
</script>

<script type="text/x-red" data-help-name="pixel">
	<p> updates the display with vysnc </p>
</script>

<script type="text/javascript">
	RED.nodes.registerType('image-to-matrix',
	{
		category: 'LED Matrix',
		color: '#a6bbcf',

		defaults:
		{
			name: {value:""},
			file: {value:""},
			xOffset: {value:0, required:true}, 
			yOffset: {value:0, required:true}, 
			matrix: { type:'led-matrix', required:true},
		},

		inputs:1,
		outputs:0,
		icon: "file.png",
		label: function()
		{
			return this.name || "image to matrix";
		}
	});
</script>

<script type="text/x-red" data-template-name="image-to-matrix">
	<div class="form-row">
		<label for="node-config-input-name"> <i class="icon-tag"></i> Name </label>
		<input type="text" id="node-input-name" placeholder="Name">
	</div>

	<div class="form-row"> 
		<label for="node-config-input-xOffset"> <i class="fa fa-tag"></i> X position</label> 
		<input type="number" id="node-input-xOffset" min="0" placeholder="0"/> 
	<div>

	<div class="form-row"> 
		<label for="node-config-input-yOffset"> <i class="fa fa-tag"></i> Y position</label> 
		<input type="number" id="node-input-yOffset" min="0" placeholder="0" /> 
	<div>


	<div class='form-row'>
		<label for="node-config-input-matrix"><i class='fa fa-tag'></i> Display</label>
		<input type='text' id='node-input-matrix'/>
	</div>


</script>


<script type="text/javascript">
	RED.nodes.registerType("clear-matrix",
	{
		category: 'LED Matrix',
		color: '#a6bbcf',
		defaults:
		{
			name: {value:""},
			matrix: {type: "led-matrix",required:true},
		},
		inputs:1,
		outputs:0,
		icon: "file.png",
		label: function()
		{
			return this.name || "led-matrix";
		}
	});
</script>

<script type="text/x-red" data-template-name = "clear-matrix">
	<div class="form-row">
		<label for="node-config-input-name"> <i class="icon-tag"></i> Name </label>
		<input type="text" id="node-input-name" placeholder="Name">
	</div>

	<div class="form-row">
		<label for="node-config-input-matrix"><i class='fa fa-tag'></i> Display </label>
		<input type="text" id="node-input-matrix"/>
	</div>
</script>

<script type="text/x-red" data-help-name="clear-matrix">
	<p> clear pixels off the display </p>
</script>


<script type="text/javascript">

		function componentToHex(c) 
		{
			var hex = c.toString(16);
			return hex.length == 1 ? "0" + hex : hex;
		}

		function rgbToHex(r, g, b) 
		{
			return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
		}


    RED.nodes.registerType('text-to-matrix',{
        category: 'LED Matrix',
        color: '#a6bbcf',

        defaults: {
            name: {value:""},
			xOffset:      {value:0, required: true}, 
			yOffset:	  {value:0, required: true}, 
			rgb:		  {value:"0,255,41"}, 
			font: {value:"/home/pi/node-red-contrib-led-matrix/9x18B.bdf", required:true},
			matrix: { type:'led-matrix', required:true},
        },

        inputs:1,
        outputs:0,
        icon: "file.png",
        label: function() {
            return this.name||"text to matrix";
        },

		oneditprepare: function ()
		{
			$("#node-input-rgb2").change(function() 
			{
				var hex = $("#node-input-rgb2").val();
				var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
				hex = hex.replace(shorthandRegex, function(m, r, g, b) {
					return r + r + g + g + b + b;
				});

				var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
				var output =  "" + parseInt(result[1], 16) + ',' + parseInt(result[2], 16) + ',' + parseInt(result[3], 16);

				$("#node-input-rgb").val(output);
			});

			var tr = $("#node-input-rgb").val(); 
			var split = tr.split(','); 

			$("#node-input-rgb2").val( rgbToHex( parseInt(split[0]), parseInt(split[1]), parseInt(split[2])));

			$("#node-config-input-font").change(function()
				{
					this.font = $("#node-config-input-font").val();
				});


			$("#node-config-input-font").val(this.font);

        },

		oneditsave: function ()
		{
			this.font = $("#node-config-input-font").val();
			//this.font = $("#node-config-input-font").val();

		},

    });
</script>



<script type="text/x-red" data-template-name="text-to-matrix">
    <div class="form-row">
        <label for="node-config-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>

	<div class='form-row' id="node-config-input-front-row">
		<label for='node-config-input-font'><i class='icon-tag'></i> Font</label>

		<select id="node-config-input-font">
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/clR6x12.bdf">clR6x12</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/helvR12.bdf">helvR12</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/tom-thumb.bdf">tom-thumb</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/4x6.bdf">4x6</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/5x7.bdf">5x7</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/5x8.bdf">5x8</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/6x9.bdf">6x9</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/6x10.bdf">6x10</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/6x12.bdf">6x12</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/6x13.bdf">6x13</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/6x13B.bdf">6x13B</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/6x13O.bdf">6x13O</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/7x13.bdf">7x13</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/7x13B.bdf">7x13B</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/7x13O.bdf">7x13O</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/7x14.bdf">7x14</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/7x14B.bdf">7x14B</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/8x13.bdf">8x13</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/8x13B.bdf">8x13B</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/8x13O.bdf">8x13O</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/9x15.bdf">9x15</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/9x15B.bdf">9x15B</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/9x18.bdf">9x18</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/9x18B.bdf">9x18B</option>
				<option value="/home/pi/node-rpi-rgb-led-matrix/external/matrix/fonts/10x20.bdf">10x20</option>
		</select>
	</div>

	<div class="form-row"> 
		<label for="node-config-input-xOffset"> <i class="fa fa-tag"></i> X position</label> 
		<input type="number" id="node-input-xOffset" min="0" placeholder="0"/> 
	<div>

	<div class="form-row"> 
		<label for="node-config-input-yOffset"> <i class="fa fa-tag"></i> Y position</label> 
		<input type="number" id="node-input-yOffset" min="0" placeholder="0" /> 
	<div>

	<div class='form-row'>
		<label for="node-config-input-matrix"><i class='fa fa-tag'></i> Display</label>
		<input type='text' id='node-input-matrix'/>
	</div>

	<div class = "form-row">
		<label for="node-config-input-rgb"><i class="icon-tag"></i>RGB color </label>
		<input type="text" id="node-input-rgb" placeholder="112,79,86">
	</div>

	<div class = "form-row">
		<label for="node-config-input-rgb2"><i class="icon-tag"></i>Color picker</label>
		<input type="color" id="node-input-rgb2" placeholder="#43DB2D">
	</div>

	
</script>

<script type="text/x-red" data-help-name="text">
    <p>prints text to the matrix buffer, refresh the matrix to see the result </p>
</script>

<script type="text/javascript">
	RED.nodes.registerType('pixel-transform',
	{
		category: 'LED Matrix',
		color: '#a6bbcf',
		defaults:
		{
			name:		{value:""},
			xOffset:	{value:0},
			yOffset:	{value:0},
			refresh:	{value:0},
			rgb:		{value:"0,255,41"},

		},
		inputs: 1,
		outputs: 1,
		icon: "file.png",
		label: function()
		{
			return this.name || "Data Transform!";
		},


		oneditprepare: function () 
		{

			$("#node-input-rgb2").change(function() 
			{
				var hex = $("#node-input-rgb2").val();
				var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
				hex = hex.replace(shorthandRegex, function(m, r, g, b) {
					return r + r + g + g + b + b;
				});

				var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
				var output =  "" + parseInt(result[1], 16) + ',' + parseInt(result[2], 16) + ',' + parseInt(result[3], 16);

				$("#node-input-rgb").val(output);
			});

			var tr = $("#node-input-rgb").val(); 
			var split = tr.split(','); 

			$("#node-input-rgb2").val( rgbToHex( parseInt(split[0]), parseInt(split[1]), parseInt(split[2])));


		},

		oneditsave: function () 
		{
		},




	});
</script>

<script type="text/x-red" data-template-name="pixel-transform">
	<div class = "form-row">
		<label for="node-config-input-name"><i class="icon-tag"></i> Name </label>
		<input type="text" id="node-input-name" placeholder="Name">
	</div>

	<div class = "form-row">
		<label for="node-config-input-xOffset"><i class="icon-tag"></i>X </label>
		<input type="text" id="node-input-xOffset" placeholder="0">
	</div>

	<div class = "form-row">
		<label for="node-config-input-yOffset"><i class="icon-tag"></i>Y </label>
		<input type="text" id="node-input-yOffset" placeholder="0">
	</div>

	<div class = "form-row">
		<label for="node-config-input-rgb"><i class="icon-tag"></i>RGB color </label>
		<input type="text" id="node-input-rgb" placeholder="255,255,255">
	</div>

	<div class = "form-row">
		<label for="node-config-input-rgb2"><i class="icon-tag"></i>Color picker</label>
		<input type="color" id="node-input-rgb2">
	</div>


</script>

<script type="text/x-red" data-help-name="pixel-transform">
    <p>modifies properties of a display object, or spawns one from a string </p>
</script>

<script type="text/javascript">

	function componentToHex(c) 
	{
		var hex = c.toString(16);
		return hex.length == 1 ? "0" + hex : hex;
	}

	function rgbToHex(r, g, b) 
	{
		return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
	}


	RED.nodes.registerType('circle-to-matrix', 
		{
			category: 'LED Matrix', 
			color: '#a6bbcf', 

			defaults: 
			{
				name:	{value:""}, 
				xPos:	{value:0, required: true}, 
				yPos:	{value:0, required: true}, 
				radius: {value:0, required: true}, 
				rgb:	{value:"0,255,41"}, 

				matrix: {type: 'led-matrix', required:true}, 
			}, 

			inputs: 1, 
			outputs:0, 
			icon: "file.png", 
			label: function () 
			{
				return this.name || "circle to matrix"; 
			}, 

			oneditprepare: function ()
			{
				$("#node-input-rgb2").change(function() 
				{
					var hex = $("#node-input-rgb2").val();
					var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
					hex = hex.replace(shorthandRegex, function(m, r, g, b) {
						return r + r + g + g + b + b;
					});

					var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
					var output =  "" + parseInt(result[1], 16) + ',' + parseInt(result[2], 16) + ',' + parseInt(result[3], 16);

					$("#node-input-rgb").val(output);
				});

				var tr = $("#node-input-rgb").val(); 
				var split = tr.split(','); 

				$("#node-input-rgb2").val( rgbToHex( parseInt(split[0]), parseInt(split[1]), parseInt(split[2])));
			}, 
		});
</script>

<script type="text/x-red" data-template-name="circle-to-matrix"> 

	<div class="form-row">
		<label for="node-config-input-name"><i class="icon-tag"></i> Name </label> 
		<input type="text" id="node-input-name" placeholder="Name"> 
	</div> 

	<div class="form-row"> 
		<label for="node-config-input-xPos"> <i class="fa fa-tag"></i> X Position </label> 
		<input type="number" id="node-input-xPos" min = "0" placeholder="0" />
	<div> 

	<div class="form-row"> 
		<label for="node-config-input-yPos"> <i class="fa fa-tag"></i> Y Position </label> 
		<input type="number" id="node-input-yPos" min = "0" placeholder="0" />
	<div> 

	<div class="form-row"> 
		<label for="node-config-input-radius"> <i class="fa fa-tag"></i> Radius </label> 
		<input type="number" id="node-input-radius" min = "0" placeholder="0" />
	<div> 


	<div class = "form-row">
		<label for="node-config-input-rgb"><i class="icon-tag"></i>RGB color </label>
		<input type="text" id="node-input-rgb" placeholder="112,79,86">
	</div>

	<div class = "form-row">
		<label for="node-config-input-rgb2"><i class="icon-tag"></i>Color picker</label>
		<input type="color" id="node-input-rgb2" placeholder="#43DB2D">
	</div>

	<div class='form-row'>
		<label for="node-config-input-matrix"><i class='fa fa-tag'></i> Display</label>
		<input type='text' id='node-input-matrix'/>
	</div>


</script> 

<script type="text/javascript">

	function componentToHex(c) 
	{
		var hex = c.toString(16);
		return hex.length == 1 ? "0" + hex : hex;
	}

	function rgbToHex(r, g, b) 
	{
		return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
	}


	RED.nodes.registerType('line-to-matrix', 
	{
		category: 'LED Matrix', 
		color: '#a6bbcf', 

		defaults: 
		{
			name:	{value:""}, 
			x0Pos:	{value:0, required: true}, 
			y0Pos:  {value:0, required: true}, 
			x1Pos:  {value:0, required: true}, 
			y1Pos:  {value:0, required: true}, 
			rgb:	{value:"0, 255, 41"}, 

			matrix:	{type: 'led-matrix', required: true}, 
		}, 

		inputs: 1, 
		outputs: 0, 
		icon: "file.png", 
		label: function ()
		{
			return this.name || "line to matrix";
		}, 

		oneditprepare: function () 
		{

				$("#node-input-rgb2").change(function() 
				{
					var hex = $("#node-input-rgb2").val();
					var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
					hex = hex.replace(shorthandRegex, function(m, r, g, b) {
						return r + r + g + g + b + b;
					});

					var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
					var output =  "" + parseInt(result[1], 16) + ',' + parseInt(result[2], 16) + ',' + parseInt(result[3], 16);

					$("#node-input-rgb").val(output);
				});

				var tr = $("#node-input-rgb").val(); 
				var split = tr.split(','); 

				$("#node-input-rgb2").val( rgbToHex( parseInt(split[0]), parseInt(split[1]), parseInt(split[2])));
		}, 
	});
</script> 


<script type="text/x-red" data-template-name="line-to-matrix">

<!--
	<div class="form-row">
		<label for="node-config-input-name"><i class="icon-tag"></i> Name </label> 
		<input type="text" id="node-input-name" placeholder="Name"> 
	</div> 
-->

	<div class="form-row"> 
		<div class ="col">
			<label for="node-config-input-x0Pos"> <i class="fa fa-tag"></i> X0 Position </label> 
			<input type="number" id="node-input-x0Pos" min = "0" placeholder="0" />
		</div> 
		<div class ="col">
			<label for="node-config-input-y0Pos"> <i class="fa fa-tag"></i> Y0 Position </label> 
			<input type="number" id="node-input-y0Pos" min = "0" placeholder="0" /> 
		</div>
	<div> 
	
	<div class="form-row">
		<div class="col"> 
			<label for="node-config-input-x1Pos"> <i class="fa fa-tag"></i> X Position </label> 
			<input type="number" id="node-input-x1Pos" min = "0" placeholder="0" />
		<div> 
		<div class="col"> 
			<label for="node-config-input-y1Pos"> <i class="fa fa-tag"></i> Y Position </label> 
			<input type="number" id="node-input-y1Pos" min = "0" placeholder="0" />
		<div> 
	</div>


	<div class = "form-row">
		<label for="node-config-input-rgb"><i class="icon-tag"></i>RGB color </label>
		<input type="text" id="node-input-rgb" placeholder="112,79,86">
	</div>

	<div class = "form-row">
		<label for="node-config-input-rgb2"><i class="icon-tag"></i>Color picker</label>
		<input type="color" id="node-input-rgb2" placeholder="#43DB2D">
	</div>
	
	<div class='form-row'>
		<label for="node-config-input-matrix"><i class='fa fa-tag'></i> Display</label>
		<input type='text' id='node-input-matrix'/>
	</div>

</script>


			

